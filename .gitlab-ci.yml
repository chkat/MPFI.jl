image: registry.gitlab.inria.fr/navarop/julia:latest

stages:
  - deploy # mandatory name for the stage to GitLab detect it's a Pages deployment


# pages:
#   tags:
#     - ci.inria.fr
#   stage: deploy
#   image: python:alpine
#   before_script:
#     - apk add git
#     - pip install mkdocs
#     # Add your custom theme if not inside a theme_dir
#     # (https://github.com/mkdocs/mkdocs/wiki/MkDocs-Themes)
#     - pip install mkdocs-material
#     # Add your plugins
#     - pip install pygments
#     - pip install pymdown-extensions
#     - pip install mkdocs-awesome-pages-plugin
#     - pip install pyembed-markdown
#     - pip install mkdocs-git-revision-date-plugin
#     - pip install plantuml-markdown
#   script:
#     - mkdocs build
#   artifacts:
#     paths:
#       - public
#   only:
#     - main

pages:
  tags:
    - ci.inria.fr
  stage: deploy
  script:
    #- apt-get update -qq && apt-get install -y git # needed by Documenter
    # - pwd
    # - which julia
    # - cd /usr/local/julia/bin
    # - ls -a 
    # - julia
    #- julia --project=@. -e "import Pkg; Pkg.build()"
    - pwd
    - ls -a
    - julia -e 'using Pkg; Pkg.add(path=pwd())' # rebuild Julia (can be put somewhere else I'm sure
    - julia -e 'using Pkg; import MPFI; Pkg.add("Documenter")' # install Documenter
    - julia --color=yes docs/make.jl # make documentation
    - mv docs/build public # move to the directory picked up by Gitlab pages
  artifacts:
    paths:
      - public
  only:
  - main